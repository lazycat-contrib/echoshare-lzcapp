import{d as U,u as R,j as r,a as k,w as b,E as q,G as w,i as S,e as A,T as E,A as n,B,l as T,q as C,s as c,k as M,z as x,y as F,o as V,_ as j}from"./index.DoEgvpef.js";import{u as L,c as z}from"./useAutoReceive.Cxi0rg11.js";import{u as G,c as N,a as O}from"./useAutoPlay.CCLiOSYS.js";const Q=U({__name:"fullview",setup(H){const{t:o}=R();let e=r(null),g=r(null),l=r(null);const u=T(),h=C(),t=k(),_=r(0),i=r(!1),d=r(!1),s=r(null);b(()=>t.targetUID,a=>{h.push({query:{uid:a}})}),G(s,"Fullscreen Receiver");const{clearAutoReceive:y,restartAutoReceive:P}=L(s,v,!0);function f(){y(),e.value&&e.value.id&&(c.warning("Cleaning up Peer instance soon",e.value.id),N(e,l,g))}function D(){e.value=O(void 0,M(u.query.peer)),e.value.on("error",a=>{n("⚠️ "+String(a)),f(),(t.enableAutoRefetch||u.query.refetch!==void 0)&&(v(),setTimeout(()=>x(o("toast.tryRefetchAfterError")),1500))}),e.value.on("open",()=>{var m;c.success("Peer instance has been created",(m=e.value)==null?void 0:m.id);const a=z(0);if(l.value=e.value.call(t.targetUID,a),l.value===null){n(o("toast.badPeer"));return}l.value.on("stream",p=>{c.success("Media stream loading complete",t.targetUID),c.success("Timeout check","Below threshold, check passed"),F(["Please check the media stream data",p]),g.value=p,i.value=!0,_.value=0,d.value=!1,s.value.srcObject=p,s.value.muted=!0,P()})})}function v(){if(f(),i.value=!1,!s.value){n(o("toast.loadingErr"));return}try{d.value=!0,D()}catch(a){d.value=!1,i.value=!1,n(o("toast.mediaErr")),B(a)}finally{window.addEventListener("beforeunload",()=>{f()})}}function I(){if(u.query.uid){t.targetUID=u.query.uid;return}if(t.targetUID&&!u.query.uid){h.push({query:{uid:t.targetUID}});return}}return I(),q(I),w(()=>{y(),t.targetUID&&t.targetUID.length>0?v():alert(o("toast.emptyUID"))}),(a,m)=>(V(),S(E,{to:"body"},[A("video",{class:"video-fit-screen",ref_key:"screenVideo",ref:s,autoplay:"",controls:""},null,512)]))}}),X=j(Q,[["__scopeId","data-v-eb853f5d"]]);export{X as default};
